<!DOCTYPE html>
<html>
<head>
    <title>Marquez API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Marquez API Test</h1>
        
        <div id="results"></div>
        
        <script>
            async function testMarquezAPI() {
                const resultsDiv = document.getElementById('results');
                
                // Test 1: Direct API call (will likely fail due to CORS)
                try {
                    console.log('Testing direct API call...');
                    const response = await fetch('http://localhost:8080/api/v1/namespaces/data_pipeline/jobs');
                    const data = await response.json();
                    
                    resultsDiv.innerHTML += `
                        <div class="section success">
                            <h3>‚úÖ Direct API Call Success</h3>
                            <p>Found ${data.totalCount} jobs</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } catch (error) {
                    resultsDiv.innerHTML += `
                        <div class="section error">
                            <h3>‚ùå Direct API Call Failed (CORS)</h3>
                            <p>Error: ${error.message}</p>
                        </div>
                    `;
                }
                
                // Test 2: Using a CORS proxy
                try {
                    console.log('Testing with CORS proxy...');
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                    const targetUrl = 'http://localhost:8080/api/v1/namespaces/data_pipeline/jobs';
                    
                    const response = await fetch(proxyUrl + targetUrl, {
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    const data = await response.json();
                    
                    resultsDiv.innerHTML += `
                        <div class="section success">
                            <h3>‚úÖ CORS Proxy Success</h3>
                            <p>Found ${data.totalCount} jobs</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } catch (error) {
                    resultsDiv.innerHTML += `
                        <div class="section error">
                            <h3>‚ùå CORS Proxy Failed</h3>
                            <p>Error: ${error.message}</p>
                        </div>
                    `;
                }
                
                // Test 3: Check if Marquez UI is accessible
                try {
                    console.log('Testing Marquez UI access...');
                    const response = await fetch('http://localhost:3001');
                    
                    if (response.ok) {
                        resultsDiv.innerHTML += `
                            <div class="section success">
                                <h3>‚úÖ Marquez UI Accessible</h3>
                                <p>Marquez UI is running on <a href="http://localhost:3001" target="_blank">http://localhost:3001</a></p>
                                <p>You can access the full lineage visualization there.</p>
                            </div>
                        `;
                    }
                } catch (error) {
                    resultsDiv.innerHTML += `
                        <div class="section error">
                            <h3>‚ùå Marquez UI Not Accessible</h3>
                            <p>Error: ${error.message}</p>
                        </div>
                    `;
                }
            }
            
            // Run tests when page loads
            testMarquezAPI();
        </script>
    </div>
</body>
</html>
